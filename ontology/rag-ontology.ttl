@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix p-plan: <http://vocab.linkeddata.es/p-plan#> .
@prefix rag: <http://example.org/rag-vocab#> .

<http://example.org/rag-ontology> rdf:type owl:Ontology ;
    rdfs:label "RAG System Ontology" ;
    rdfs:comment "Ontology for the Retrieval-Augmented Generation (RAG) system." .

### RAG System Plan
rag:RAGPlan rdf:type p-plan:Plan ;
    rdfs:label "RAG System Plan" ;
    rdfs:comment "The plan that describes the workflow of the RAG system." .

### RAG System Multi-Steps
rag:Retrieve rdf:type prov:Activity, p-plan:MultiStep ;
    rdfs:label "Retrieve" ;
    rdfs:comment "RAG Stage 1: The multi-step activity of retrieving documents based on a prompt." ;
    p-plan:isStepOf rag:RAGPlan .

rag:Generation rdf:type prov:Activity, p-plan:MultiStep ;
    rdfs:label "Generation" ;
    rdfs:comment "RAG Stage 2: The multi-step activity of generating a response based on retrieved documents and a prompt template." ;
    p-plan:isStepOf rag:RAGPlan ;
    p-plan:isPrecededBy rag:Retrieve .

### Steps in Retrieve
rag:EmbedUserQuery rdf:type prov:Activity, p-plan:Step ;
    rdfs:label "Embed user query" ;
    rdfs:comment "The activity of embedding a user prompt." ;
    p-plan:isStepOf rag:Retrieve .

rag:SimilaritySearch rdf:type prov:Activity, p-plan:Step ;
    rdfs:label "Similarity Search" ;
    rdfs:comment "The activity of performing a similarity search based on a prompt embedding." ;
    p-plan:isStepOf rag:Retrieve ;
    p-plan:isPrecededBy rag:EmbedUserQuery .

### Steps in Generation
rag:buildGenerationPrompt rdf:type prov:Activity, p-plan:Step ;
    rdfs:label "Build Generation Prompt" ;
    rdfs:comment "The activity of building a prompt based on the retrieved documents and the prompt template." ;
    p-plan:isStepOf rag:Generation ;
    p-plan:isPrecededBy rag:SimilaritySearch .

rag:GenerateResponse rdf:type prov:Activity, p-plan:Step ;
    rdfs:label "Generate Response" ;
    rdfs:comment "The activity of generating a response based on the prompt and language model." ;
    p-plan:isStepOf rag:Generation ;
    p-plan:isPrecededBy rag:buildGenerationPrompt .

### RAG System Entities
rag:UserQuery rdf:type prov:Entity ;
    rdfs:label "User Query" ;
    rdfs:comment "The initial query provided by the user." .

rag:UserQueryEmbedding rdf:type prov:Entity, rag:Embedding ;
    rdfs:label "Prompt Embedding" ;
    rdfs:comment "The embedded representation of the user query." ;
    prov:wasGeneratedBy rag:EmbedUserQuery ;
    prov:wasDerivedFrom rag:UserQuery .

rag:RetrievedDocuments rdf:type prov:Entity, rag:Document ;
    rdfs:label "Retrieved Documents" ;
    rdfs:comment "The documents retrieved based on the user query." ;
    prov:wasGeneratedBy rag:SimilaritySearch ;
    prov:wasDerivedFrom rag:UserQueryEmbedding .

rag:PromptTemplate rdf:type prov:Entity ;
    rdfs:label "Prompt Template" ;
    rdfs:comment "The template used for generating a response." .

rag:GenerationPrompt rdf:type prov:Entity ;
    rdfs:label "Generation Prompt" ;
    rdfs:comment "The prompt created for generating the final response." ;
    prov:wasGeneratedBy rag:buildGenerationPrompt ;
    prov:wasDerivedFrom rag:RetrievedDocuments, rag:PromptTemplate .

rag:GeneratedResponse rdf:type prov:Entity ;
    rdfs:label "Generated Response" ;
    rdfs:comment "The final response generated by the RAG system." ;
    prov:wasGeneratedBy rag:GenerateResponse ;
    prov:wasDerivedFrom rag:GenerationPrompt, rag:LanguageModel .
